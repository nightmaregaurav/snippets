# 40GB disk space required: 20GB original image 20GB your container.
docker pull sickcodes/docker-osx:auto

# Prepare Host
sudo pacman -Syu qemu libvirt dnsmasq virt-manager bridge-utils flex bison iptables-nft edk2-ovmf ebtables netctl libvirt-dbus libguestfs xorg-xhost
sudo systemctl enable --now libvirtd
sudo systemctl enable --now virtlogd
sudo systemctl enable --now docker
echo 1 | sudo tee /sys/module/kvm/parameters/ignore_msrs
sudo modprobe kvm
sudo usermod -aG docker "${USER}"
sudo usermod -aG libvirt "${USER}"
sudo usermod -aG kvm "${USER}"
xhost +

# Add isolated network:
docker network create catalina_osx_network

# Add folder to share with mac
mkdir -p ~/DockerShare/catalina_osx_shared

# Boot directly into a real OS X shell with a visual display [NOT HEADLESS]
# default username is user
# default passsword is alpine
docker run -itd \
     --device /dev/kvm \
     -e AUDIO_DRIVER=pa,server=unix:/tmp/pulseaudio.socket \
     -e PULSE_SERVER=unix:/tmp/pulseaudio.socket \
     -v "/run/user/$(id -u)/pulse/native:/tmp/pulseaudio.socket" \
     --name catalina_osx \
     --network catalina_osx_network \
     -p 50922:10022 \
     -v /tmp/.X11-unix:/tmp/.X11-unix \
     -v "~/DockerShare/catalina_osx_shared:/mnt/hostshare" \
     -e EXTRA="-virtfs local,path=/mnt/hostshare,mount_tag=hostshare,security_model=passthrough,id=hostshare" \
     -e "DISPLAY=${DISPLAY:-:0.0}" \
     -e GENERATE_UNIQUE=true \
     -e TERMS_OF_USE=i_agree \
     -e CPU_STRING=$(nproc) \
     -e RAM=8
     sickcodes/docker-osx:auto

# To mount the shared folder, Open Terminal inside macOS and run the following command
sudo -S mount_9p hostshare

# To resume container after stopping or shutdown
docker start catalina_osx

# To automate it: (After this, just type catalina_osx in terminal)
sudo echo "docker start catalina_osx >> /dev/null && docker exec -it --user=oracle <container_name> bash" >> catalina_osx
sudo mv catalina_osx /bin/
sudo chmod 774 /bin/catalina_osx

# Install brew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# To change password
passwd